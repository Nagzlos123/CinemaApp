CREATE OR REPLACE TRIGGER dodawanie_seansu BEFORE INSERT ON seans FOR EACH ROW DECLARE liczba INT; BEGIN SELECT COUNT(*) INTO liczba FROM seans WHERE data=:NEW.data AND godzina=:NEW.godzina AND id_sali=:NEW.id_sali; IF liczba>0 THEN RAISE_APPLICATION_ERROR(-20001, 'Już istnieje seans w tym dniu o tej godzinie i w tej samej sali'); END IF; END; /
CREATE OR REPLACE TRIGGER dodawanie_seansu2 BEFORE INSERT ON seans FOR EACH ROW BEGIN IF :NEW.data<CURRENT_DATE THEN RAISE_APPLICATION_ERROR(-20001, 'Nie można dodać seansu ze starszą datą'); END IF; END; /
CREATE OR REPLACE TRIGGER usuwanie_filmu BEFORE DELETE ON film FOR EACH ROW BEGIN RAISE_APPLICATION_ERROR(-20001, 'W tym momencie usuwanie filmow nie jest możliwe'); END; /
CREATE OR REPLACE TRIGGER dodawanie_filmu AFTER INSERT ON film FOR EACH ROW BEGIN DBMS_OUTPUT.ENABLE; DBMS_OUTPUT.PUT_LINE('Proszę pamiętać o dodaniu gatunku filmu w tabeli film_gatunek'); IF :NEW.opis IS NULL THEN DBMS_OUTPUT.PUT_LINE('Zalecane jest dodawanie opisu filmu'); END IF; END; /
CREATE OR REPLACE TRIGGER dodawanie_biletu AFTER INSERT ON bilet FOR EACH ROW DECLARE cena_biletu FLOAT; data_seansu DATE; godz_seansu VARCHAR2(6); tytul_filmu VARCHAR2(50); numer_sali VARCHAR2(10); BEGIN SELECT cena INTO cena_biletu FROM cennik WHERE id=:NEW.id_cennika; SELECT data INTO data_seansu FROM seans WHERE id=:NEW.id_seansu; SELECT godzina INTO godz_seansu FROM seans WHERE id=:NEW.id_seansu; SELECT tytul INTO tytul_filmu FROM film WHERE id=(SELECT id_filmu FROM seans WHERE id=:NEW.id_seansu); SELECT nr INTO numer_sali FROM sala WHERE id=(SELECT id_sali FROM seans WHERE id=:NEW.id_seansu); DBMS_OUTPUT.ENABLE; DBMS_OUTPUT.PUT_LINE('----------------------------------------'); DBMS_OUTPUT.PUT_LINE('----------- Kupiono bilet --------------'); DBMS_OUTPUT.PUT_LINE('----------------------------------------'); DBMS_OUTPUT.PUT_LINE('Tytul filmu: ' || TO_CHAR(tytul_filmu)); DBMS_OUTPUT.PUT_LINE('Cena biletu: ' || TO_CHAR(cena_biletu)); DBMS_OUTPUT.PUT_LINE('Data seansu: ' || TO_CHAR(data_seansu)); DBMS_OUTPUT.PUT_LINE('Godzina seansu: ' || TO_CHAR(godz_seansu)); DBMS_OUTPUT.PUT_LINE('Numer sali: ' || TO_CHAR(numer_sali)); DBMS_OUTPUT.PUT_LINE('----------------------------------------'); END; /